name: pick-files
base: core22
adopt-info: pick-files-go

summary: A script that picks a random selection of files
description: |
  A script that copies a random selection of files from a set of folders to a
  single destination folder.
icon: icon/icon-256.svg
license: Apache-2.0
source-code: https://github.com/nicolasbock/filechooser
website: https://filechooser.readthedocs.io/

grade: stable
confinement: strict

apps:
  pick-files-legacy:
    command: usr/bin/pick-files-legacy
    plugs:
      - home
      - removable-media
  pick-files:
    command: usr/bin/pick-files
    plugs:
      - home
      - removable-media

parts:
  pick-files-go:
    plugin: dump
    source: .
    build-snaps:
      - go
    override-build: |
      set -e -u -x
      VERSION=$(git describe --tags)
      craftctl set version=${VERSION}
      go build -ldflags "-X main.Version=${VERSION}" -o pick-files ./...
      install --mode 0755 -D pick-files ${CRAFT_PART_INSTALL}/usr/bin/pick-files

  pick-files-python:
    plugin: python
    source: .
    python-requirements:
      - requirements.txt
    organize:
      bin/pick-files: usr/bin/pick-files-legacy
